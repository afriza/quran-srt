<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- Tell the browser to be responsive to screen width -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Quran Translation SRT Subtitle">
	<meta name="author" content="Afriza N. Arief">
	<title>Download All Translated Languages of The Holy Quran</title>
	<!-- Bootstrap Core CSS -->
	<link href="/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />
	<!-- morris CSS -->
	<link href="/assets/plugins/morrisjs/morris.css" rel="stylesheet">
	<link href="/assets/plugins/sweetalert/sweetalert.css" rel="stylesheet" type="text/css">
	<link href="/assets/plugins/select2/dist/css/select2.min.css" rel="stylesheet" type="text/css">
	<!-- Custom CSS -->
	<link href="/css/style.css" rel="stylesheet">
	<!-- You can change the theme colors from here -->
	<link href="/css/colors/blue.css" id="theme" rel="stylesheet">
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->

	<script src="/assets/plugins/jquery/jquery.min.js"></script>
	<script src="/assets/plugins/popper/popper.min.js"></script>
	<script src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="/js/jquery.slimscroll.js"></script>
	<script src="/js/waves.js"></script>
	<script src="/js/sidebarmenu.js"></script>
	<script src="/assets/plugins/sticky-kit-master/dist/sticky-kit.min.js"></script>
	<script src="/js/custom.min.js"></script>
	<script src="/assets/plugins/sparkline/jquery.sparkline.min.js"></script>
	<script src="/assets/plugins/raphael/raphael-min.js"></script>
	<script src="/assets/plugins/morrisjs/morris.min.js"></script>
	<!--<script src="/js/dashboard1.js"></script>-->
	<script src="/assets/plugins/styleswitcher/jQuery.style.switcher.js"></script>
	<script src="/assets/plugins/datatables/jquery.dataTables.min.js"></script>
	<script src="/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
	<script src="/assets/plugins/blockUI/jquery.blockUI.js"></script>
	<script src="/assets/plugins/sweetalert/sweetalert.min.js"></script>
	<script src="/assets/plugins/select2/dist/js/select2.min.js"></script>
	<script src="/assets/plugins/datatables/natural.js"></script>
	<script src="/js/js.cookie.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/wretch/2.5.2/wretch.min.js" integrity="sha512-ODUFGt849cHLqlJP/v/oweHgkM+t31GgIsGZPLka5uDiRpclLfZAXusSOQXGieA4aLUC0bjq4ua1X6uJ9oVA1A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<style>
		body {
			zoom: 90%;
		}

		.table td, .table th {
			padding: .50rem;
		}

		.container-fluid {
			padding: 0 15px 15px 15px;
		}

		.page-titles {
			margin: 0 0px 15px;
			padding: 10px 5px;
		}

		.table.dataTable tbody tr td.dataTables_empty {
			text-align: center;
		}
	</style>
</head>
<body class="fix-header fix-sidebar card-no-border">

<div id="main-wrapper">
	<header class="topbar">
		<nav class="navbar top-navbar navbar-expand-md navbar-light">
			<div class="navbar-collapse">
				<!-- ============================================================== -->
				<!-- toggle and nav items -->
				<!-- ============================================================== -->
				<ul class="navbar-nav mr-auto mt-md-0">
					<!-- This is  -->
					<li class="nav-item"> <a class="nav-link nav-toggler hidden-md-up text-muted waves-effect waves-dark" href="javascript:void(0)"><i class="mdi mdi-menu"></i>Change Translations</a> </li>
					<li class="nav-item m-l-10"> <a class="nav-link sidebartoggler hidden-sm-down text-muted waves-effect waves-dark" href="javascript:void(0)"><i class="ti-menu"></i>Change Translations</a> </li>
				</ul>
			</div>
		</nav>
	</header>

	<aside class="left-sidebar" style="width: auto">
		<div class="scroll-sidebar">
			<nav class="sidebar-nav">
				<ul id="sidebarnav">

					<li id="lang_sample" class="hide"><a class="waves-effect waves-dark" href="#" aria-expanded="false"><i class="fa fa-list"></i><span class="hide-menu"><span class="lang-name">Sample</span>
							<div class="form-check">
								<input class="form-check-input hide" type="radio" name="sample" id="sample-1" value="1" checked>
								<label class="form-check-label" for="sample-1">Dr. Mustafa Khattab</label>
							</div>
							</span></a>
					</li>

				</ul>
			</nav>
		</div>
	</aside>

<div class="page-wrapper">
	<div class="row page-titles">
		<div class="col-md-12 align-self-center">
			<h3 class="text-themecolor">Download All Translated Languages of The Holy Quran</h3>
		</div>
	</div>
	<div class="container-fluid">

	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="card-body">
					<form id="input-form" class="form-horizontal form-material needs-validation" action="" method="POST" enctype="multipart/form-data">

					<h5>Download All Translated Languages of The Holy Quran</h5>
					<hr>

					<div class="row">
						<div class="form-group col-md-6">
							<label class="font-weight-bold" for="surah_list">Surah Number / Name	</label>
							<select class="select2 form-control form-control-line" id="surah_list" name="surah_list" onchange="surah_changed(this)">
								<option value="">-- Surah Number &amp; Name --</option>
							</select>
						</div>

						<div class="form-group col-md-3">
							<label class="font-weight-bold" for="ayah_first">First Ayah</label>
							<input type="number" id="ayah_first" name="ayah_first" min="1" value=""
								pattern="[0-9]+" placeholder=""
								class="form-control form-control-line" required>
						</div>

						<div class="form-group col-md-3">
							<label class="font-weight-bold" for="ayah_last">Last Ayah</label>
							<input type="number" id="ayah_last" name="ayah_last" min="1" value=""
								pattern="[0-9]+" placeholder=""
								class="form-control form-control-line" required>
							</select>
						</div>

						<div class="form-group col-md-3">
							<button onclick="surah_ayah_update()" type="button" class="btn btn-outline-success btn-sm">Update</button>
						</div>
					</div>

					<div class="table-responsive">
						<table id="table-ayah" class="display nowrap table table-hover table-bordered"
							   cellspacing="0" width="100%">
						<thead>
							<tr>
								<th>Ayah</th>
								<th>Start</th>
								<th>End</th>
								<th>Translation Preview</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Ayah #</td>
								<td>
									<input type="text" id="start_1" name="start_1" value=""
										pattern="([0-9]{1,2}:){0,2}[0-9]+([.][0-9]+)?" placeholder="1:02:03.456" size="13" maxlength="13"
										required> <!-- class="form-control form-control-line" -->
								</td>
								<td>
									<input type="text" id="start_1" name="start_1" value=""
										pattern="([0-9]{1,2}:){0,2}[0-9]+([.][0-9]+)?" placeholder="1:02:03.456" size="13" maxlength="13"
										required> <!-- class="form-control form-control-line" -->
								</td>
								<td>Translation Preview</td>
							</tr>
						</tbody>
						</table>
					</div>

					<div class="form-group">
						<div class="col-sm-12">
							<button id="download" onclick="" class="btn btn-info" type="button">Download as zipped SRT files</button>
						</div>
					</div>

					</form>
				</div>
			</div>

		</div>
		<!-- Column -->
	</div>

	</div>
</div>
</div>


<script>
let surah = null
let chapters = null
let translations = null

let lang_list = $('#sidebarnav')
let lang_sample = $('#lang_sample')
let surah_list = $('#surah_list')
let ayah_first = $('#ayah_first')
let ayah_last = $('#ayah_last')

let api = wretch('https://api.quran.com/api/v4')

function list_surah() {
	api.get('/chapters').json(jo => {
		let data = []
		chapters = jo.chapters
		chapters.forEach(el => {
			data.push({
				id: el.id,
				text: `${el.id}. ${el.name_simple} (${el.translated_name.name})`
			})
			surah_list.select2({data})
		})
	})
}

function list_translations() {
	api.get('/resources/translations').json(jo => {
		translations = jo.translations
		translations.forEach(trn => {
			let lang_name = trn.language_name.toLowerCase()
			let li = lang_list.find('#'+ lang_name)
			if (li.length > 0) {
				let el_div_last = li.find('div').last()
				let el_div = el_div_last.clone()
				el_div.find('input').prop('checked', false)
				set_trn_lang(el_div, trn, lang_name)
				el_div_last.after(el_div)
			} else {
				let lis = lang_list.find('li')
				let el_li = lang_sample.clone()
				el_li.attr('id', lang_name)
				el_li.find('span[class=lang-name]').text(lis.length +'. '+ upper_words_first(lang_name))
				el_li.removeClass('hide')
				el_li.find('input').attr('name', lang_name)
				el_li.find('input').prop('checked', true)
				set_trn_lang(el_li, trn, lang_name)
				lang_sample.before(el_li)
			}
		})
	})
}

function set_trn_lang(el, trn, lang_name) {
	let elem = $(el)
	let el_input = elem.find('input')
	el_input.attr('id', `${lang_name}-${trn.id}`)
	el_input.attr('value', trn.id)
	let el_label =  elem.find('label')
	el_label.attr('for', `${lang_name}-${trn.id}`)
	let text = trn.name
	if (!text.includes(trn.author_name)) {
		//text += '; ' + trn.author_name
	}
	el_label.text(text)
}

function surah_changed(el) {
	let id = el.options[el.selectedIndex].value
	surah = chapters?.[id-1]
	if (surah) {
		let n = surah.verses_count
		ayah_first.attr('max', n)
		ayah_first.attr('placeholder', 'max: ' + n)
		ayah_last.attr('max', n)
		ayah_last.attr('placeholder', 'max: ' + n)
	} else {
		ayah_first.attr('placeholder', '')
		ayah_last.attr('placeholder', '')
	}
}

function surah_ayah_update() {
	let n = surah?.verses_count
	let f = ayah_first.val()
	let l = ayah_last.val()
	let ok = f >= 1 && l >= 1 && f <= n && l <= n && f <= l
	if (!ok) {
		alert('Please use valid surah and ayah range!')
		return
	}
	//api.get('/quran/translations/tn-id')
}

$(function(){
	$('#table-ayah').DataTable({
		order: [[0, 'asc']],
	});

	list_surah()
	list_translations()
})

function upper_words_first(str) {
	let s = ''
	let i = 0
	do {
		str = str.substring(0,1).toUpperCase()+str.substring(1)
		i = str.indexOf(' ') + 1
		s += str.substring(0, i)
		str = str.substring(i)
	} while (i > 0)
	s += str
	return s
}

</script>

</body>
</html>
